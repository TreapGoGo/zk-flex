# Forge 脚本说明

## 📜 脚本用途

### FundAccounts.s.sol（新增）

**用途**：给你的地址真正转账

```
功能：
  - 使用 Anvil Account #0（有 10,000 ETH）
  - 给 Bob_real 转 100 ETH
  - 给 Bob_proxy 转 50 ETH
  - 给 Alice 转 10 ETH
  - 真正的链上转账（MetaMask 可见）

何时使用：
  ✅ Demo 前先运行
  ✅ 让你的地址有钱
  ✅ 才能在前端用 MetaMask 发交易
```

---

### Deploy.s.sol

**用途**：部署核心合约

```
功能：
  - 部署 WealthProofRegistry
  - 自动部署 Groth16Verifier
  - 生成 broadcast 文件

何时使用：
  ✅ 每次启动链后
  ✅ 部署合约到本地链
  ✅ 前端需要合约地址
```

---

### DemoSimple.s.sol

**用途**：完整演示（Terminal 演示用）

```
功能：
  - 部署合约
  - 创建钱包池实例（包含你的地址）
  - 创建余额快照
  - vm.deal 给地址发钱（仅脚本内部）
  - 展示完整流程

何时使用：
  ✅ Terminal 演示时
  ✅ 展示给评委看
  ✅ 说明系统工作原理

⚠️ 注意：
  - vm.deal 的钱只在脚本执行时有效
  - 不会真正改变链上余额
  - MetaMask 看不到这些钱
```

---

## 🔑 关键区别

### vm.deal（测试用）

```solidity
vm.deal(address, amount);  // Cheatcode

效果：
  ✅ 脚本执行时有效
  ❌ 脚本结束后失效
  ❌ MetaMask 看不到
  
用途：
  - Foundry 测试
  - 演示脚本
  - 模拟余额
```

### payable.transfer（真实转账）

```solidity
payable(address).transfer(amount);  // 真实交易

效果：
  ✅ 永久有效
  ✅ 链上可见
  ✅ MetaMask 可见
  
用途：
  - 给地址发钱
  - 真实转账
  - Demo 前准备
```

---

## 🎯 正确的 Demo 流程

### 如果需要在前端用 MetaMask 发交易

```bash
# 1. 给你的地址转账（真实转账）
forge script script/FundAccounts.s.sol ... --broadcast

# 2. 检查 MetaMask
打开 MetaMask
切换到 localhost:8545
查看余额：应该有 ETH 了 ✅

# 3. 部署合约
forge script script/Deploy.s.sol ... --broadcast

# 4. 生成 ABI
node scripts-js/generateTsAbis.js

# 5. 启动前端
yarn start

# 6. 使用 MetaMask 在前端创建实例
访问 /zk-flex/bob
连接 MetaMask（Bob_proxy 账户）
点击 "Create Instance"
✓ 有钱，可以发交易！
```

---

### 如果只是演示（Terminal 演示）

```bash
# 直接运行 DemoSimple.s.sol
forge script script/DemoSimple.s.sol ... --broadcast

# 展示输出给评委
# 不需要前端
# 不需要 MetaMask
# 只展示 Terminal
```

---

## 📋 总结

| 脚本 | 部署合约 | 给地址转账 | MetaMask 可见 | 用途 |
|------|---------|-----------|-------------|------|
| **FundAccounts.s.sol** | ❌ | ✅ 真实转账 | ✅ | Demo 前准备 |
| **Deploy.s.sol** | ✅ | ❌ | N/A | 部署合约 |
| **DemoSimple.s.sol** | ✅ | ⚠️ vm.deal | ❌ | Terminal 演示 |

---

**现在明白了吗？**

- FundAccounts = 给你发真钱
- Deploy = 部署合约
- DemoSimple = Terminal 演示（假钱）

要用前端 → 先运行 FundAccounts.s.sol！

